<?php/* * this program can able to receive the message from the rabbitmq messaging queue * and store into a mysql database */// include the libraryrequire_once __DIR__ . '/../../../vendor/autoload.php';use PhpAmqpLib\Connection\AMQPStreamConnection;//create a connection to the server$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');$channel = $connection->channel();//publish a message to the task_queue:$channel->queue_declare('task_queue', false, true, false, false);echo ' [*] Waiting for the messages', "\n";// callback array function for message queue$callback = function($msg){    echo " [x] Received ", $msg->body, "\n";    // decode the jeson message    var_dump(json_decode($msg->body, true));    echo " [x] Done", "\n";    $msg->delivery_info['channel']->basic_ack($msg->delivery_info['delivery_tag']);    $array_value = json_decode($msg->body, true);    // get the array value from the jeson message    $array_values = array_values($array_value);$json_data = $array_value[$array_values];    //Declare the db    $servername = "localhost";    $username = "root";   $password = "magentodbpass";   $dbname = "lsapp";    try {        $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);        // set the PDO error mode to exception        $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);// insert into the database pr_producers table the array valuesforeach($json_data as $value){            $sql = "INSERT INTO `pr_producers` (`PK_pr_producers`, `FK_pr_regions`, `firstname`, `lastname`, `family_members`,`lng`,  `lat`, `adress`, `phone_number`, `location`, `statement`, `id`) VALUES('".$value[$array_values]."','".$value[$array_values]."', '".$value[$array_values]."', '".$value[$array_values]."', '".$value[$array_values]."', '".$value[$array_values]."', '".$value[$array_values]."','".$value[$array_values]."','".$value[$array_values]."','".$value[$array_values]."','".$value[$array_values]."',NULL);";}//        $sql = "INSERT INTO `pr_producers` (`PK_pr_producers`, `FK_pr_regions`, `firstname`, `lastname`, `family_members`,`lng`,  `adress`, `phone_number`, `location`, `lat`, `statement`, `id`)// VALUES('$array_values[0][0][5]','$array_values[0][0][2]', '$array_values[0][0][0]', '$array_values[0][0][11]', '$array_values[0][0][4]', '$array_values[0][0][1]', '$array_values[0][0][6]','$array_values[0][0][7]','$array_values[0][0][8]','$array_values[0][0][9]','$array_values[0][0][3]',NULL);";        $conn->exec($sql);        echo "New record created successfully";    }    catch(PDOException $e)    {        echo $sql . "<br>" . $e->getMessage();    }    $conn = null;};$channel->basic_qos(null, 1, null);$channel->basic_consume('task_queue', '', false, false, false, false, $callback);while(count($channel->callbacks)) {    $channel->wait();}//we close the channel and the connection$channel->close();$connection->close();